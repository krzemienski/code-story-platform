# Plan 01-05: Story Plan Generation

## Objective

Generate structured chapter plans from user intent, creating a roadmap for story content.

## Context

- Spec reference: `/home/nick/code-story/docs-plans-prompts-specs/codestory.md`
- Intent captured via: IntentChat â†’ onIntentComplete callback
- Story generation: `app/api/stories/generate/route.ts`

## Pre-conditions

- [x] Intent analysis exists (validated in 01-04)
- [x] Story generation API exists
- [ ] Chapter structure in story output

## Tasks

### Task 1: Validate Story Generation Uses Intent

**Type**: validation
**Files**: `app/api/stories/generate/route.ts`

**Action**: Verify story generation:
- Receives intent from request
- Uses intent to guide content
- Produces chapter structure

**Verify**: Intent referenced in generation flow

**Done**: [ ]

---

### Task 2: Validate StoryPlan/ChapterPlan Types

**Type**: validation
**Files**: `lib/types.ts`

**Action**: Verify TypeScript types exist:
- `StoryPlan` interface
- `ChapterPlan` interface
- Fields: title, duration, focus_files, key_concepts

**Verify**: Types exported

**Done**: [ ]

---

### Task 3: Validate Story Architect Prompt

**Type**: validation
**Files**: `lib/agents/prompts.ts`

**Action**: Verify STORY_ARCHITECT_PROMPT:
- Defines story structure generation
- Includes chapter planning guidance
- Supports multiple narrative styles

**Verify**: Prompt comprehensive for plan generation

**Done**: [ ]

---

## Validation Gates

### Gate 1: Intent Used in Generation
\`\`\`bash
grep -E "(intent|focus)" app/api/stories/generate/route.ts | head -5
\`\`\`
**Expected**: References found

### Gate 2: Plan Types Exist
\`\`\`bash
grep -E "StoryPlan|ChapterPlan" lib/types.ts
\`\`\`
**Expected**: Types defined

### Gate 3: Story Architect Prompt Exists
\`\`\`bash
grep "STORY_ARCHITECT_PROMPT" lib/agents/prompts.ts && echo "PASS" || echo "FAIL"
\`\`\`
**Expected**: PASS

## Acceptance Criteria

- [ ] Story generation uses intent for customization
- [ ] StoryPlan/ChapterPlan types defined
- [ ] STORY_ARCHITECT_PROMPT guides structure
- [ ] Generated stories reflect user intent

## Post-conditions

- Stories tailored to user's learning goals
- Chapter structure based on intent category
- Foundation for voice synthesis
