# Plan 01-04: Intent Analysis

## Objective

Implement AI-powered analysis of user intent to suggest focus areas and story structure.

## Context

- Spec reference: `/home/nick/code-story/docs-plans-prompts-specs/codestory.md`
- Intent captured via: IntentChat component
- Analysis model: Claude (via Vercel AI SDK)

## Pre-conditions

- [x] IntentChat component exists (validated in 01-03)
- [x] AI endpoint exists (`/api/chat/intent`)
- [ ] INTENT_AGENT_PROMPT defined

## Tasks

### Task 1: Validate Intent Agent Prompt Exists

**Type**: validation
**Files**: `lib/agents/prompts.ts`

**Action**: Verify INTENT_AGENT_PROMPT is defined with:
- Role definition (intent gathering agent)
- Guidance for asking questions
- Focus area suggestions
- Output format for structured plan

**Verify**: Export exists, prompt comprehensive

**Done**: [ ]

---

### Task 2: Validate Intent Analysis in Chat Flow

**Type**: validation
**Files**: `app/api/chat/intent/route.ts`

**Action**: Verify AI endpoint uses intent prompt:
- System prompt includes INTENT_AGENT_PROMPT
- Context includes repo info
- Streaming response configured

**Verify**: Prompt used in route

**Done**: [ ]

---

### Task 3: Assess Analysis Quality

**Type**: analysis
**Files**: `lib/agents/prompts.ts`

**Action**: Evaluate if current prompt produces structured analysis:
- Does it suggest focus areas?
- Does it recommend narrative style?
- Does it propose chapter structure?

**Verify**: Prompt includes structured output guidance

**Done**: [ ]

---

## Validation Gates

### Gate 1: Prompt Exported
```bash
grep -l "INTENT_AGENT_PROMPT" lib/agents/prompts.ts && echo "PASS" || echo "FAIL"
```
**Expected**: PASS

### Gate 2: Prompt Used in API
```bash
grep "INTENT_AGENT_PROMPT" app/api/chat/intent/route.ts && echo "PASS" || echo "FAIL"
```
**Expected**: PASS

### Gate 3: Prompt Has Structure Guidance
```bash
grep -E "(focus|chapter|structure|plan)" lib/agents/prompts.ts | head -5
```
**Expected**: Matches found

## Acceptance Criteria

- [ ] INTENT_AGENT_PROMPT defined in prompts.ts
- [ ] Prompt used by /api/chat/intent
- [ ] Prompt guides focus area suggestions
- [ ] Analysis flow produces actionable output

## Post-conditions

- AI can analyze user intent
- Focus areas suggested based on intent
- Foundation for story plan generation
